@page "/Test.html"
@using Extension.Models
@using Extension.Services
@using System.Reactive.Linq
@inject NavigationManager navManager
@inject IPreferencesService preferencesService
@using static Extension.AppConfig;
@inject IJSRuntime js
@using static Extension.Helper.PreviousPage
@inject ILogger<PreferencesPage> logger
@inject AppCache a
@using System.Linq.Expressions

@inherits AppCacheReactiveComponentBase

@code
{
    private class BoolItem
    {
        public Expression<Func<bool>> Condition { get; set; } = default!;
        public string? Label { get; set; }
        public int Indent { get; set; }
        public BoolItem(Expression<Func<bool>> condition, string? label = null, int indent = 0)
        {
            Condition = condition;
            Label = label;
            Indent = indent;
        }
    }

    private List<BoolItem> Conditions = new();

    protected override async Task OnInitializedAsync() {
        await base.OnInitializedAsync(); // Must call inherited method
        Conditions = new()
        {
            new BoolItem(() => a.IsReadyToTransact, null, 0),
            new BoolItem(() => a.IsNotWaiting, null, 1),
            new BoolItem(() => a.IsNotWaitingOnKeria, null, 2),
            new BoolItem(() => a.IsNotWaitingOnUser, null, 2),
            new BoolItem(() => a.IsNotWaitingOnPendingRequests, null, 2),
            new BoolItem(() => a.IsBwNotWaitingOnApp, null, 2),
            new BoolItem(() => a.IsAppNotWaitingOnBw, null, 2),
            new BoolItem(() => a.IsConnectedToKeria, null, 1),
            new BoolItem(() => a.IsIdentifierFetched, null, 2),
            new BoolItem(() => a.IsAuthenticated, null, 2),
            new BoolItem(() => a.IsUnlocked, null, 3),
            new BoolItem(() => a.IsPasscodeInSession, null, 4),
            new BoolItem(() => a.IsNotExpired, null, 4),
            new BoolItem(() => a.IsPasscodeHashSet, null, 4),
            new BoolItem(() => a.IsInitialized, null, 3),
            new BoolItem(() => a.IsConfigured, null, 4),
            new BoolItem(() => a.IsKeriaInitialConnectSuccess, null, 6),
            new BoolItem(() => a.IsPasscodeHashSet, null, 5),
            new BoolItem(() => a.IsKeriaConfigValidated, null, 5),
            new BoolItem(() => a.IsProductOnboarded, null, 5),
            new BoolItem(() => a.IsPrivacyAgreed, null, 6),
            new BoolItem(() => a.IsPrivacyAgreedUtc, null, 7),
            new BoolItem(() => a.IsPrivacyHashExpected, null, 7),
            new BoolItem(() => a.IsTosAgreed, null, 6),
            new BoolItem(() => a.IsTosAgreedUtc, null, 7),
            new BoolItem(() => a.IsTosHashExpected, null, 7),
            new BoolItem(() => a.IsInstallAcknowledged, null , 6),
            new BoolItem(() => a.IsInstalledVersionAcknowledged, null, 7),
            new BoolItem(() => a.MyOnboardState.IsWelcomed, null, 7),
        };
    }
}

<div id="@this.GetType().Name" class="bt-body-page">
    <div class="d-flex gap-3 bt-main">
        <div class="bt-main-inside-scroll">
            <MudText Typo="Typo.h6">Test</MudText>
            <MudStack>
                <MudStack Spacing="1">
                    @foreach (var item in Conditions) {
                        <TestPageComponent Condition="@item.Condition" Label="@item.Label" Indent="@item.Indent" />
                    }
                </MudStack>
            </MudStack>
        </div>
    </div>
    <MudStack Row="true" class="bt-button-tray">
        <MudIconButton Icon="@Icons.Material.Filled.ArrowBackIosNew" Variant="Variant.Text" OnClick='@( async () => await GoBack(js) )' Class="justify-start" />
        <MudSpacer />
    </MudStack>
</div>
