@page "/ManageKeriAgentServices.html"
@layout Layouts.MainLayout
@using Extension.Models
@using Extension.Services
@using Extension.Services.Storage
@using static Extension.Helper.PreviousPage

@inject NavigationManager navManager
@inject IJSRuntime js
@inject AppCache appCache
@inject ILogger<ManageKeriAgentServicesPage> logger

@implements IDisposable

@code {
    protected override async Task OnInitializedAsync() {
        await this.SubscribeToAppCache(appCache);
        logger.LogInformation("ManageKeriAgentServicesPage OnInitializedAsync");
    }

    public void Dispose() {
        this.UnsubscribeFromAppCache();
        GC.SuppressFinalize(this);
    }
}

<div id="@this.GetType().Name" class="bt-body-page">
    <div class="d-flex gap-3 bt-main">
        <div class="bt-main-inside-scroll">
            <MudText Class="bt-page-title">Manage KERIA Connections</MudText>
            <MudStack>
                <MudText Typo="Typo.body1" Class="pt-4">
                    Configure and manage your KERIA Cloud Service connections.
                </MudText>

                @if (appCache.MyKeriaConnectConfigs.Configs.Count == 0)
                {
                    <MudText Typo="Typo.body2" Color="Color.Secondary" Class="pt-2">
                        No KERIA connections configured.
                    </MudText>
                }
                else
                {
                    <MudList T="string" Class="pt-2">
                        @foreach (var kvp in appCache.MyKeriaConnectConfigs.Configs)
                        {
                            <MudListItem>
                                <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                    <MudStack>
                                        <MudText Typo="Typo.body2">
                                            <b>@(kvp.Value.Alias ?? "(unnamed)")</b>
                                        </MudText>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                                            @kvp.Value.AdminUrl
                                        </MudText>
                                    </MudStack>
                                    @if (kvp.Key == appCache.MyPreferences.KeriaPreference.SelectedKeriaConnectionDigest)
                                    {
                                        <MudChip T="string" Color="Color.Primary" Size="Size.Small">Active</MudChip>
                                    }
                                </MudStack>
                            </MudListItem>
                        }
                    </MudList>
                }

                <MudText Typo="Typo.caption" Color="Color.Secondary" Class="pt-4">
                    Add/Remove functionality coming soon.
                </MudText>
            </MudStack>
        </div>
    </div>
    <MudStack Row="true" class="bt-button-tray">
        <MudIconButton Icon="@Icons.Material.Filled.ArrowBackIosNew" Variant="Variant.Text"
                       OnClick='@(async () => await GoBack(js))' Class="justify-start" />
        <MudSpacer />
    </MudStack>
</div>
