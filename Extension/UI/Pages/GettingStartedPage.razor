@page "/GettingStarted.html"
@using Extension.Models
@using Extension.Models.Storage
@using Extension.Services.Storage
@using Extension.Utilities

@inject IStorageService storageService
@inject ILogger<ConfigurePage> logger
@inject HttpClient httpClient
@inject NavigationManager navManager
@inject IJSRuntime js
@inject ISignifyClientService signifyClientService
@inject ISnackbar snackbar
@inject IJsRuntimeAdapter jsRuntimeAdapter
@inject AppCache appCache  // Non-reactive here unless/until SubscribeToAppCache() is added in OnInitializedAsync
@using FluentResults

@code {

    // fields
    MudButton? buttonRef;

    // properties

    // computed properties

    protected override async Task OnInitializedAsync()
    {

    }

    protected override async Task OnAfterRenderAsync(bool isFirstRender)
    {
        if (isFirstRender)
        {
            if (buttonRef is not null)
            {
                await buttonRef.FocusAsync();
            }
        }
    }

    private async Task NavigateToNextAsync()
    {
        var updatedOnboardState = appCache.MyOnboardState with
        {
            ShowedGettingStarted = true
        };
        await storageService.SetItem<OnboardState>(updatedOnboardState);
        await appCache.WaitForAppCache([() => appCache.MyOnboardState.ShowedGettingStarted == true]);
        navManager.NavigateTo(Routes.PathFor<Index>());
    }
}

<div id="@this.GetType().Name" class="bt-body-page">
    <div class="d-flex gap-3 bt-main">
        <div class="bt-main-inside-scroll">
            <MudText Class="bt-page-title">Getting Started</MudText>
            <MudStack>
                <MudText>
                    Thank you for installing and configuring KERI Auth. Here are some tips to help you get started:
                </MudText>
                <MudList T="string" Dense="true">
                    <MudListItem>
                        <MudText>Pin the extension action button.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText>Notice the icon color and lock indicator.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText>Explore the menu, preferences.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText>Try the SidePanel.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText>Sign into a KERI-enabled site.</MudText>
                    </MudListItem>
                </MudList>
                <MudText>
                    Click "Next" to continue.
                </MudText>
            </MudStack>
        </div>
    </div>
    <MudStack Row="true" class="bt-button-tray">
        <!-- Intentionally no back button here -->
        <MudSpacer />
        <MudButton Variant="Variant.Filled" @ref="buttonRef" Color="Color.Primary" OnClick="@NavigateToNextAsync" Class="justify-start" data-testid="next">Next</MudButton>
    </MudStack>
</div>
