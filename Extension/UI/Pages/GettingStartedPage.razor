@page "/GettingStarted.html"
@using Extension.Models
@using Extension.Models.Storage
@using Extension.Services.Storage
@using Extension.Utilities

@inject IStorageService storageService
@inject ILogger<ConfigurePage> logger
@inject HttpClient httpClient
@inject NavigationManager navManager
@inject IJSRuntime js
@inject ISignifyClientService signifyClientService
@inject ISnackbar snackbar
@inject IJsRuntimeAdapter jsRuntimeAdapter
@inject AppCache appCache  // Non-reactive here unless/until SubscribeToAppCache() is added in OnInitializedAsync
@using FluentResults

@code {

    // fields
    MudButton? buttonRef;

    // properties

    // computed properties

    protected override async Task OnInitializedAsync()
    {

    }

    protected override async Task OnAfterRenderAsync(bool isFirstRender)
    {
        if (isFirstRender)
        {
            if (buttonRef is not null)
            {
                await buttonRef.FocusAsync();
            }
        }
    }

    private async Task NavigateToNextAsync()
    {
        var updatedOnboardState = appCache.MyOnboardState with
        {
            ShowedGettingStarted = true
        };
        await storageService.SetItem<OnboardState>(updatedOnboardState);
        await appCache.WaitForAppCache([() => appCache.MyOnboardState.ShowedGettingStarted == true]);
        navManager.NavigateTo(Routes.PathFor<Index>());
    }
}

<div id="@this.GetType().Name" class="bt-body-page">
    <div class="d-flex gap-3 bt-main">
        <div class="bt-main-inside-scroll">
            <MudText Class="bt-page-title">Getting Started</MudText>
            <MudStack>
                <MudText>
                    Thank you for installing and configuring KERI Auth. Here are some tips to help you get started:
                </MudText>
                <MudList T="string" Dense="true">
                    <MudListItem>
                        <MudText><b>Pin the extension:</b> Click the puzzle piece icon (Extensions) in your browser toolbar, then click the pin icon next to KERI Auth to keep it visible.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText><b>Watch the icon status:</b> Grey = no page connection, Cyan = connected to page, Lock = session locked (you'll be prompted to unlock as needed).</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText><b>Interact with a website page:</b> Pages that implement the Polaris-web interfaces may interact with KERI Auth after the user clicks on the extension icon, providing your permission for KERI Auth and the page to interact.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText><b>Multiple user interface contexts:</b> Tab, Popup, and SidePanel. The Tab ("options") or SidePanel mode can be launched via the KERI Auth icon context menu.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText><b>Try the SidePanel:</b> Right-click the extension icon and select "Open side panel" for a persistent view while browsing.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText><b>Popup:</b> When interacting with a page, KERI Auth may use the Popup if the SidePanel is not open.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText><b>Open the menu</b> from KERI Auth's Tab or SidePanel, use the upper-left icon to access your Identifiers, Credentials, Preferences, and more.</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText><b>Session auto-locks</b> after inactivity. You'll be prompted to re-enter your passcode or registered passkey to unlock.</MudText>
                    </MudListItem>
                </MudList>
                <MudText>
                    Click "Next" to continue.
                </MudText>
            </MudStack>
        </div>
    </div>
    <MudStack Row="true" class="bt-button-tray">
        <!-- Intentionally no back button here -->
        <MudSpacer />
        <MudButton Variant="Variant.Filled" @ref="buttonRef" Color="Color.Primary" OnClick="@NavigateToNextAsync" Class="justify-start" data-testid="next">Next</MudButton>
    </MudStack>
</div>
