@using static Extension.Helper.Identicon
@inject IJSRuntime js

@* Displays an AID prefix with identicon, abbreviated text, full-prefix tooltip, and optional name/alias. *@

<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
    <MudTooltip Text="@Prefix" Delay="500" Arrow="true">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
            @if (ShowIdenticon)
            {
                <MudIcon ViewBox="0 0 100 100" Icon="@MakeIdenticon(Prefix)" Class="bt-identicon" Style="@IdenticonStyle" />
            }
            @if (Name is not null)
            {
                <MudStack Class="gap-0">
                    <span style="font-family: monospace; font-size: 0.85rem;">@Abbreviated</span>
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">@Name</MudText>
                </MudStack>
            }
            else
            {
                <span style="font-family: monospace; font-size: 0.85rem;">@Abbreviated</span>
            }
        </MudStack>
    </MudTooltip>
    @if (ShowCopyButton)
    {
        <MudIconButton Icon="@Icons.Material.Filled.ContentCopy"
                       Size="Size.Small"
                       OnClick="CopyToClipboard"
                       Style="padding: 0px !important;"
                       aria-label="Copy prefix" />
    }
</MudStack>

@code {
    [Parameter, EditorRequired]
    public string Prefix { get; set; } = "";

    [Parameter]
    public string? Name { get; set; }

    [Parameter]
    public int HeadChars { get; set; } = 4;

    [Parameter]
    public int TailChars { get; set; } = 4;

    [Parameter]
    public bool ShowIdenticon { get; set; } = true;

    [Parameter]
    public bool ShowCopyButton { get; set; } = true;

    [Parameter]
    public string IdenticonStyle { get; set; } = "width: 1.5rem; height: 1.5rem;";

    string Abbreviated => string.IsNullOrEmpty(Prefix) || Prefix.Length <= HeadChars + TailChars + 3
        ? Prefix ?? ""
        : $"{Prefix[..HeadChars]}\u2026{Prefix[^TailChars..]}";

    async Task CopyToClipboard()
    {
        await js.InvokeVoidAsync("navigator.clipboard.writeText", Prefix);
    }
}
