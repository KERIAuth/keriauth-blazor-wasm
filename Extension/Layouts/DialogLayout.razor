@inherits BaseLayout

@inject IJSRuntime jsRuntime
@inject AppCache appCache  // Reactive: inherits subscription from BaseLayout
@inject ILogger<BaseLayout> logger

<MudThemeProvider Theme="@AppConfig.MyCustomTheme" IsDarkMode="@appCache.MyPreferences.IsDarkTheme" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider Style="z-index:9999" />

<CascadingValue Value="this">
    <MudLayout id="@this.GetType().Name" Style="overflow-y:hidden; overflow-x:hidden; box-sizing: border-box; position:absolute; top:0; width:100vw;">
        <MudAppBar Elevation="2" Style="padding-left: 0px; padding-right: 0px; height:var(--bt-appbar-height);">
            <MudStack Style="height:inherit; width: 100%; padding-bottom:8px;" Class="d-flex pt-2" Row="true">
                 <MudButton Href="@RouteToIndex" Style="padding: 10px; height:fit-content; align-self:center; border:none; border-radius:16px; background:#00000020;">
                    <img src="images/logo512.png" alt="Icon" style="width: 24px; height: 24px;" />
                    <MudText Style="margin-left:7px; font-size:larger; color:hsl(183deg 100% 50%); font-variant: small-caps;">KeriAuth</MudText>
                </MudButton>

                <MudStack Row="true" Style="margin-left:16px; display:flex; align-items:center;">
                    <MudText Typo="Typo.caption" Style="@TimeoutText.Style">
                        @TimeoutText.Text
                    </MudText>
                </MudStack>

                <MudSpacer />
            </MudStack>
        </MudAppBar>
        <MudMainContent Class="bt-main-content" Style="left:0; top:61px;">
            <MudContainer MaxWidth="MaxWidth.Large" Style="height:inherit; min-height:inherit; padding-left:0; padding-right:0;">
                @Body
            </MudContainer>
        </MudMainContent>
    </MudLayout>
</CascadingValue>

@code {
    /// <summary>
    /// Closes the popup window (when DialogLayout is rendered in popup context)
    /// </summary>
    public async Task ClosePopupAsync() {
        await jsRuntime.InvokeVoidAsync("window.close");
    }

    protected override async Task HandleAppCacheChanged()
    {
        await base.HandleAppCacheChanged();
        logger.LogInformation("HandleAppCacheChanged");
        StateHasChanged();
    }

    public override async ValueTask DisposeAsync()
    {
        await base.DisposeAsync();
    }
}

<style>
    #DialogLayout {
        margin: 0px;
    }
</style>
